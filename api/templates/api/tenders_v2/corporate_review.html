{% extends 'api/base.html' %}
{% block title %}Review Tender (v2) | BlueQuant{% endblock %}
{% block content %}
<div class="max-w-6xl mx-auto px-6 py-10 space-y-8">
  <div class="p-6 bg-white border">
    <div class="text-2xl font-bold mb-1">{{ tender.tender_title }}</div>
    <div class="text-neutral-600 mb-2">Required Credits: {{ tender.required_credits }} • Status: {{ tender.status }}</div>
    <div class="text-neutral-600 mb-2">Location Pref: {{ tender.location_preference|default:'-' }} • Budget: {{ tender.budget_range|default:'-' }} • Deadline: {{ tender.deadline|date:'Y-m-d'|default:'-' }}</div>
    <p class="text-neutral-700">{{ tender.description }}</p>
  </div>

  <div>
    <h2 class="text-xl font-semibold mb-4">Proposals</h2>
    <div class="grid gap-4">
      {% for p in proposals %}
      <div class="p-5 border bg-white">
        <div class="flex items-center justify-between mb-2">
          <div class="font-semibold">{{ p.contributor.username }}</div>
          <div class="text-sm text-neutral-500">{{ p.created_at|date:'M d, Y H:i' }}</div>
        </div>
        <div class="text-sm text-neutral-600 mb-2">Offered Credits: {{ p.offered_credits }} • Price per credit: {{ p.price_per_credit }} • Location: {{ p.project_location }}</div>
        {% if p.project_description %}<p class="text-neutral-700 mb-2">{{ p.project_description }}</p>{% endif %}
        {% if p.supporting_documents %}<a class="underline text-primary-700" href="{{ p.supporting_documents.url }}" target="_blank">Download documents</a>{% endif %}
        <div class="flex items-center gap-3 mt-3">
          <span class="px-2 py-1 text-xs bg-neutral-100">{{ p.status }}</span>
          {% if tender.status != 'Closed' and p.status != 'Accepted' %}
          <form method="post" action="{% url 'tender_v2_accept' tender.id p.id %}">
            {% csrf_token %}
            <button type="submit" class="px-3 py-2 bg-primary-600 text-white text-sm">Accept</button>
          </form>
          <form method="post" action="{% url 'tender_v2_reject' tender.id p.id %}">
            {% csrf_token %}
            <button type="submit" class="px-3 py-2 bg-red-600 text-white text-sm">Reject</button>
          </form>
          {% endif %}
        </div>
      </div>
      {% empty %}
      <div class="text-neutral-600">No proposals yet.</div>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}
{% extends 'api/base.html' %}
{% block title %}Review Tender | Blue Carbon MRV{% endblock %}
{% block content %}
<div class="max-w-6xl mx-auto px-6 py-10 space-y-8">
  <div class="p-6 bg-white border">
    <div class="text-2xl font-bold mb-1">{{ tender.title }}</div>
    <div class="text-neutral-600 mb-2">Location: {{ tender.location }} • Credits: {{ tender.credits_required }} • Status: {{ tender.status }}</div>
    <div class="text-sm text-neutral-500 mb-2">
      {% if tender.location_preference %}Preference: {{ tender.location_preference }} • {% endif %}
      {% if tender.budget_range %}Budget: {{ tender.budget_range }} • {% endif %}
      {% if tender.deadline %}Deadline: {{ tender.deadline|date:'M d, Y' }}{% endif %}
    </div>
    <p class="text-neutral-700">{{ tender.description }}</p>
  </div>

  <div>
    <h2 class="text-xl font-semibold mb-4">Proposals</h2>
    <div class="overflow-x-auto bg-white border">
      <table class="min-w-full text-sm">
        <thead class="bg-neutral-50 text-neutral-600">
          <tr>
            <th class="text-left p-3">NGO</th>
            <th class="text-left p-3">Offered Credits</th>
            <th class="text-left p-3">Price/Credit</th>
            <th class="text-left p-3">Project Location</th>
            <th class="text-left p-3">Documents</th>
            <th class="text-left p-3">Status</th>
            <th class="text-left p-3">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for a in applications %}
          <tr class="border-t">
            <td class="p-3 font-medium">{{ a.ngo.first_name|default:a.ngo.username }}</td>
            <td class="p-3">{{ a.offered_credits|default:'—' }}</td>
            <td class="p-3">{% if a.price_per_credit %}{{ a.price_per_credit }}{% else %}—{% endif %}</td>
            <td class="p-3">{{ a.project_location|default:'—' }}</td>
            <td class="p-3">
              {% if a.supporting_documents %}
                <a href="{{ a.supporting_documents.url }}" target="_blank" class="text-primary-600 underline">Download</a>
              {% else %}—{% endif %}
            </td>
            <td class="p-3">
              <span class="px-2 py-1 text-xs {% if a.status == 'Accepted' %}bg-green-100 text-green-700{% elif a.status == 'Rejected' %}bg-red-100 text-red-700{% else %}bg-neutral-100 text-neutral-700{% endif %}">{{ a.status }}</span>
            </td>
            <td class="p-3">
              {% if tender.status == 'Open' %}
              <div class="flex items-center gap-2">
                <form method="post" action="{% url 'tender_accept' tender.id a.id %}">
                  {% csrf_token %}
                  <button type="submit" class="px-3 py-1.5 bg-primary-600 text-white text-xs">Accept</button>
                </form>
                <form method="post" action="{% url 'tender_reject' tender.id a.id %}">
                  {% csrf_token %}
                  <button type="submit" class="px-3 py-1.5 bg-neutral-200 text-neutral-800 text-xs">Reject</button>
                </form>
              </div>
              {% else %}
                <span class="text-neutral-500">—</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="7" class="p-4 text-neutral-600">No proposals yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
